<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset=UTF-8>
  <title>Noson & Music Services</title>
  <link rel="stylesheet" href="./bootstrap/css/bootstrap.css" type="text/css">
  <link rel="stylesheet" href="./css/base.css" type="text/css">
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
  <script src="./bootstrap/js/bootstrap.js"></script>

</head>
  <body id="index">

    <div class="container">
      <div class="row">
        <div class="page-header">
          <img src="./smapi_icon.png" style="width: 120px; height: 120px; float: left; margin-right: 20px">
          <div id="blurb">
            <p>Enable music services <i>Spotify</i>, <i>Apple music</i> and more</p>
          </div>
          <div style="clear:both;"></div>
        </div>
      </div>
        
      <div class="row" style="text-align:left">
        <div class="span12">
          <p>Some music services like Spotify, Apple Music, use authent policy OpenAuth2. Credentials data are obfuscated and so no longer readable by thrid party controller. To enable these services with your NOSON controller you have to retrieve login data by yourself using this guide. You will need a Sonos controller app for Windows or OSX, and common unix commands "<i>strings</i>" and "<i>egrep</i>" or similar tools.</p>
        </div>
        <div class="span12" style="text-align:center">
        </div>
      </div>

      <ul>
        <li>
          <p>Do the following for each service you want retrieve credentials.<p>
<h5>1 - Run the official Sonos controller in Windows or OSX</h5>
<p>Browse only the service for which you want retrieve your credentials. Open the task manager. In the task list select the program of Sonos controller and launch the memory dump of the process.<p>
<h5>2 - Upload the memory dump file to your Linux box<h5>
<p>The file is commonly named "Sonos.DMP" on Windows. You have to upload it into unix to hack its content.<p>
<h5>3 - Search the service login key in the file</h5>
<p>Type the following command to retrieve reached credentials data. In the example below the dump file is named "Sonos.DMP".<p>
<pre>strings Sonos.DMP | egrep "&lt;key&gt;.*&lt;&#47key&gt;"</pre>
The command output will print reached strings as below
<p><span style="font-family:monospace;">...lxzyPQ&lt;&#47token&gt;&lt;key&gt;<b>fbgjPCI2XvTCLpnoZN...lei0yCZKbvonTsgGx7xv</b>&lt;&#47key&gt;&lt;householdId&gt;HHID...</span><p>
The key string is encapsulated by tag "key". Copy back your key string for this service.<br>
Run again the official Sonos controller and do a new dump for each other service credentials you want to retrieve.<br>
        </li>
        <li>
          <p>Checkout related account data for the service<p>
<h5>1 - Get type number for the service account</h5>
<p>Select right value from the list below<p>
<table border="1" cellpadding="2">
<tr><th>Service name</th><th align="center">Type number</th></tr>
<tr><td>Spotify</td><td align="center">2311</td></tr>
<tr><td>Apple Music</td><td align="center">52231</td></tr>
<tr><td>Amazon Music</td><td align="center">51463</td></tr>
<tr><td>SoundCloud</td><td align="center">40967</td></tr>
<tr><td>Groove</td><td align="center">40711</td></tr>
<tr><td>FIT Radio Workout Music </td><td align="center">55559</td></tr>
<tr><td>Mixcloud</td><td align="center">46343</td></tr>
<tr><td>Anghami</td><td align="center">50695</td></tr>
<tr><td>Plex</td><td align="center">54279</td></tr>
<tr><td>Google Play Music</td><td align="center">38663</td></tr>
<tr><td>Tribe of Noise</td><td align="center">43271</td></tr>
<tr><td>Classical Archives</td><td align="center">48903</td></tr>
<tr><td>Fnac Jukebox</td><td align="center">44039</td></tr>
<tr><td>Gaana</td><td align="center">42759</td></tr>
<tr><td>Saavn</td><td align="center">41991</td></tr>
<tr><td>Bandcamp</td><td align="center">40199</td></tr>
</table><br>
<h5>2 - Get the account "<i>SerialNum</i>" for the corresponding <i>type</i> from your sonos device</h5>
<p>Go to <span style="font-family:monospace;">http://[SONOS_IP_ADDRESS]:1400/status/accounts</span> . You will find the <i>serialNum</i> for the type in the page's table as the example below.<p>
<p><img src="download/status_accounts.png"><p>
        </li>
        <li>
          <p>Register account in NOSON settings file</p>
<p>Depending of NOSON package you installed, you will find the settings file in the following folder.<p>
<table border="1">
<tr><td>NOSON legacy package</td><td align="center">~/.config/noson.janbar/noson.janbar.conf</td></tr>
<tr><td>NOSON snap package</td><td align="center">~/snap/noson/[<i>revision</i>]/.config/noson.janbar/noson.janbar.conf</td></tr>
</table><br>
<p>Edit and fill setting <i>accounts</i> with credentials data. The format is the following.<p>
<p><span style="font-family:monospace;">"type0<b>,</b>serialNum0<b>,</b>key0<b>|</b>type1<b>,</b>serialNum1<b>,</b>key1<b>|</b>type2<b>,</b>serialNum2<b>,</b>key2"</span><p>
<p>Separate each account with a character pipe "|". See the following example.<p>
<pre>[General]
accounts="2311,4,user/FR/i0yCjPCIfb...lei0y-zGa8|52231,5,fbgjPCI2XvTCLpnoZN...lei0yCZKbvonTsgGx7xv"
firstRun=false
queueIndex=0
tabIndex=0
zoneName=Salon</pre><br>
<p>Save the settings file and restart NOSON.<p>
        </li>
      </ul>

      <div class="row">
        <div id="screenshot" align="center">
          <img src="download/noson_103.png">
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <p>This website is made with <a href='http://twitter.github.com/bootstrap/'>Twitter Bootstrap</a>, themed with <a href='http://bootswatch.com'>Bootswatch</a>.</p>
        <p>noson-app is licensed under the GNU General Public License.</p>
      </div>
    </footer>
    
  </body>
</html>
